#!/system/bin/sh

# =================================================================
# –°–∫—Ä–∏–ø—Ç: unpacker.sh
# –û–ø–∏—Å–∞–Ω–∏–µ: –ë—ã—Å—Ç—Ä–∞—è —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∞ ZIP-–∞—Ä—Ö–∏–≤–æ–≤ —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
# –ê–≤—Ç–æ—Ä: GoldenFrog
# –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 28.10.2025 (Release inspired)
# =================================================================

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞
show_header() {
    clear
    echo "==========================================="
    echo "   üì¶ ANDROID FAST UNPACKER v1.0"
    echo "==========================================="
}

show_header

# 1. –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
echo "[?] –£–∫–∞–∂–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ø–æ–∏—Å–∫–∞ .zip –∞—Ä—Ö–∏–≤–æ–≤:"
printf "[¬ª] " && read -r SRC_DIR

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø—É—Ç–∏
[ -z "$SRC_DIR" ] && echo "[!] –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞" && exit 1
[ ! -d "$SRC_DIR" ] && echo "[!] –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: $SRC_DIR" && exit 1

# –û—á–∏—Å—Ç–∫–∞ –ø—É—Ç–∏ –æ—Ç –∑–∞–≤–µ—Ä—à–∞—é—â–µ–≥–æ —Å–ª–µ—à–∞
SRC_DIR="${SRC_DIR%/}"

echo
echo "[*] –ü–æ–∏—Å–∫ .zip –∞—Ä—Ö–∏–≤–æ–≤ –≤ $SRC_DIR ..."

# –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∞—Ä—Ö–∏–≤–æ–≤ –≤ –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –ø—Ä–æ–±–µ–ª–æ–≤ –≤ –∏–º–µ–Ω–∞—Ö
set -- "$SRC_DIR"/*.zip
[ ! -f "$1" ] && echo "[!] ZIP –∞—Ä—Ö–∏–≤—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã" && exit 1

ZIP_LIST="$@"
ZIP_COUNT=$#

# 2. –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –∞—Ä—Ö–∏–≤–∞
echo
if [ "$ZIP_COUNT" -eq 1 ]; then
    ZIP_FILE="$1"
    echo "[*] –ù–∞–π–¥–µ–Ω –æ–¥–∏–Ω –∞—Ä—Ö–∏–≤: $(basename "$ZIP_FILE")"
else
    echo "[*] –ù–∞–π–¥–µ–Ω–æ –∞—Ä—Ö–∏–≤–æ–≤: $ZIP_COUNT"
    i=1
    for z in $ZIP_LIST; do
        echo " [$i] $(basename "$z")"
        i=$((i+1))
    done

    echo
    printf "[?] –í—ã–±–µ—Ä–∏ –∞—Ä—Ö–∏–≤ (1-%s): " "$ZIP_COUNT"
    read -r CHOICE

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤–≤–æ–¥ —á–∏—Å–ª–∞
    case "$CHOICE" in
        ''|*[!0-9]*) echo "[!] –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–≤–æ–¥" && exit 1 ;;
    esac

    # –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ —Å —Ñ–∞–π–ª–æ–º
    i=1
    for z in $ZIP_LIST; do
        [ "$i" -eq "$CHOICE" ] && ZIP_FILE="$z"
        i=$((i+1))
    done

    [ -z "$ZIP_FILE" ] && echo "[!] –ù–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä" && exit 1
fi

# 3. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–∞—Å–ø–∞–∫–æ–≤–∫–µ
echo
echo "[*] –í—ã–±—Ä–∞–Ω: $(basename "$ZIP_FILE")"
printf "[?] –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ä–∞—Å–ø–∞–∫–æ–≤–∫—É? [y/n]: "
read -r CONFIRM
case "$CONFIRM" in
    y|Y) ;;
    *) echo "[*] –û—Ç–º–µ–Ω–µ–Ω–æ"; exit 0 ;;
esac

echo
echo "[?] –£–∫–∞–∂–∏ –∏–º—è –ø–∞–ø–∫–∏ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è:"
printf "[¬ª] " && read -r OUT_DIR

[ -z "$OUT_DIR" ] && echo "[!] –ò–º—è –Ω–µ —É–∫–∞–∑–∞–Ω–æ" && exit 1

DEST="$SRC_DIR/$OUT_DIR"
mkdir -p "$DEST" || { echo "[!] –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞–ø–∫–∏"; exit 1; }

# 4. –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏ —á–µ—Ä–µ–∑ –Ω–∞—Ç–∏–≤–Ω—ã–π –±–∏–Ω–∞—Ä–Ω–∏–∫
echo
echo "[*] –ê–Ω–∞–ª–∏–∑ –∞—Ä—Ö–∏–≤–∞..."
TOTAL=$(unzip -l "$ZIP_FILE" | awk 'END {print NR-3}')
[ "$TOTAL" -le 0 ] && echo "[!] –û—à–∏–±–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∞—Ä—Ö–∏–≤–∞" && exit 1

echo "[*] –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ –≤: $DEST"
echo

COUNT=0
# –ò—Å–ø–æ–ª—å–∑—É–µ–º unzip –Ω–∞–ø—Ä—è–º—É—é –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏
unzip -o "$ZIP_FILE" -d "$DEST" | while read -r line; do
    case "$line" in
        Extracting:*|Inflating:*)
            COUNT=$((COUNT+1))
            PERCENT=$((COUNT*100/TOTAL))
            # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
            printf "\r[*] –ü—Ä–æ–≥—Ä–µ—Å—Å: %3d%% (%d/%d)" "$PERCENT" "$COUNT" "$TOTAL"
            ;;
    esac
done

echo
echo -e "\n[+] –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
exit 0
